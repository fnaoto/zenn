---
title: "Botkitã§AWSã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "botkit", "typescript"]
published: false
---

Zennã®åˆæŠ•ç¨¿ã§ã€Botkitã®ç°¡å˜ãªä½¿ã„æ–¹ã‚’AWSã®APIã¨TypeScriptã‚’ä½¿ã£ã¦èª¬æ˜ã—ã¾ã™ã€‚
ä»Šå›ã¯Slacké€£æºã¯ã›ãšã€ç°¡å˜ãªWebã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œã£ã¦ç¢ºèªã—ã¾ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ãŠã„ã¦ç½®ãã®ã§ã€æ°—ã«ãªã‚‹äººã¯Cloneã—ã¦ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ ğŸ‘Œ

- https://github.com/fnaoto/botkit-typescript-aws-sample

## Botkitã®å§‹ã‚æ–¹

ã¾ãšã¯Botkitã‚’TypeScriptã§ä½¿ãˆã†ã‚ˆã†ã«ã—ã¾ã™ã€‚

```shell
## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

$ yarn add botkit
$ yarn add typescript
$ yarn add botbuilder-adapter-web
$ yarn add aws-sdk

## tsconfigã®ä½œæˆ

$ npx tsc --init
```

tsconfigã¯ã“ã‚“ãªæ„Ÿã˜ã«ä¿®æ­£ã—ã¾ã™ã€‚
è©³ã—ãã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚ç…§ãã ã•ã„ã€‚
- https://qiita.com/ryokkkke/items/390647a7c26933940470

```json
// tsconfig.json
{
  "compilerOptions": {
    "module": "esnext",
    "target": "esnext",
    "moduleResolution": "node"
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules"
  ]
}
```

package.jsonã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```json
// package.json
{
  "scripts": {
    "start": "node dist/index.js", // jsã‚’å®Ÿè¡Œ
    "build": "npx tsc --outDir ./dist ./src/index.ts" // tsãƒ•ã‚¡ã‚¤ãƒ«ã‚’jsã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«
  },
  "dependencies": {
    // å‰²æ„›
  }
}
```

## TypeScriptã§AWSãƒªã‚½ãƒ¼ã‚¹ã‚’å‘¼ã³å‡ºã™ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ

srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨index.tsã‚’ä½œæˆ

```
$ mkdir src
$ touch src/index.ts
```

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚
å‚è€ƒURLã¯ã“ã¡ã‚‰
- https://botkit.ai/docs/v4/platforms/web.html

```ts
import { Botkit } from "botkit";
import { WebAdapter } from "botbuilder-adapter-web";

const adapter = new WebAdapter; // botbuilder-adapter-webã‹ã‚‰adapterã‚’ä½œæˆ

const controller = new Botkit({
  adapter: adapter, // ä½œæˆã—ãŸadapterã‚’Botkitã®åˆæœŸåŒ–æ™‚ã«æ¸¡ã™
});

controller.on("message", async (bot, message) => { // messageã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§è¿”ä¿¡
  await bot.reply(message, "I received an message event."); // è¿”ä¿¡å†…å®¹
});
```

Botkitã¯æœ¬ä½“ã¨Adapterã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒåˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚
Botkitã‚’åˆæœŸåŒ–ã™ã‚‹éš›ã«ã€slackã‚„webãªã©ã®ã‚¢ãƒ€ãƒ—ã‚¿ã‚’æ¸¡ã—ã¦ã‚ã’ã‚‹ã“ã¨ã§æ©Ÿèƒ½è¿½åŠ ãŒå¯èƒ½ã§ã™ã€‚

ã“ã“ã§ã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```shell
# jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
$ yarn build

# botkitã‚’å®Ÿè¡Œã€å¾…ã¡çŠ¶æ…‹ã«ãªã‚‹
$ yarn start

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ« or ã‚·ã‚§ãƒ«ã‚’èµ·å‹•
# Botkitã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
$ curl -X POST \
    -H "Content-Type: application/json" \
    -d '{
          "type": "message",
          "text": "test",
          "channel": "websocket",
          "user": "user"
        }' \
    http://localhost:3000/api/messages

# ä»¥ä¸‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚Œã°OK
[{"type":"message","text":"I received an message event."}]
```
